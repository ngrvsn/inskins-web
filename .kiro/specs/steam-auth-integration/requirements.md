# Требования к интеграции Steam авторизации

## Введение

Необходимо доработать систему авторизации через Steam, интегрировав существующие API методы с компонентами пользовательского интерфейса. Текущая система имеет все необходимые API методы, но хук `useAuth` использует моковые данные вместо реальных запросов к серверу.

## Требования

### Требование 1

**Пользовательская история:** Как пользователь, я хочу авторизоваться через Steam, чтобы получить доступ к функциям продажи скинов

#### Критерии приемки

1. КОГДА пользователь нажимает кнопку "Войти через Steam" ТО система ДОЛЖНА получить URL авторизации Steam через API `/api/auth/steam`
2. КОГДА пользователь нажимает кнопку "Войти через Steam" ТО система ДОЛЖНА перенаправить пользователя на полученный URL Steam
3. КОГДА Steam перенаправляет пользователя обратно на `/auth/callback` ТО система ДОЛЖНА обработать параметры авторизации через API `/api/auth/steam/callback`
4. КОГДА авторизация успешна ТО система ДОЛЖНА сохранить токены в localStorage
5. КОГДА авторизация успешна ТО система ДОЛЖНА перенаправить пользователя на главную страницу

### Требование 2

**Пользовательская история:** Как авторизованный пользователь, я хочу видеть свои данные в интерфейсе, чтобы понимать свой статус в системе

#### Критерии приемки

1. КОГДА пользователь авторизован ТО хук `useAuth` ДОЛЖЕН получать данные пользователя через API `/api/auth/me`
2. КОГДА пользователь авторизован ТО хук `useAuth` ДОЛЖЕН получать данные пользователя через API `/api/users/me` для полной информации
3. КОГДА данные пользователя загружены ТО в Header ДОЛЖНЫ отображаться аватар, имя пользователя и баланс
4. КОГДА данные пользователя загружены ТО состояние `isAuthenticated` ДОЛЖНО быть `true`

### Требование 3

**Пользовательская история:** Как авторизованный пользователь, я хочу выйти из системы, чтобы завершить сессию

#### Критерии приемки

1. КОГДА пользователь нажимает "Выйти" ТО система ДОЛЖНА вызвать API `/api/auth/logout`
2. КОГДА выход выполнен ТО система ДОЛЖНА очистить токены из localStorage
3. КОГДА выход выполнен ТО система ДОЛЖНА сбросить состояние пользователя в хуке `useAuth`
4. КОГДА выход выполнен ТО система ДОЛЖНА перенаправить на главную страницу

### Требование 4

**Пользовательская история:** Как пользователь, я хочу чтобы система автоматически восстанавливала мою сессию при перезагрузке страницы, чтобы не авторизоваться заново

#### Критерии приемки

1. КОГДА приложение загружается И в localStorage есть access_token ТО система ДОЛЖНА проверить валидность токена через API `/api/auth/me`
2. КОГДА токен валиден ТО система ДОЛЖНА загрузить данные пользователя и установить состояние авторизации
3. КОГДА токен невалиден ТО система ДОЛЖНА попытаться обновить его через refresh_token
4. КОГДА refresh_token тоже невалиден ТО система ДОЛЖНА очистить токены и сбросить состояние авторизации

### Требование 5

**Пользовательская история:** Как пользователь, я хочу чтобы система корректно обрабатывала ошибки авторизации, чтобы понимать что происходит

#### Критерии приемки

1. КОГДА происходит ошибка при получении URL Steam ТО система ДОЛЖНА показать сообщение об ошибке
2. КОГДА происходит ошибка в callback ТО система ДОЛЖНА показать сообщение об ошибке и перенаправить на страницу авторизации
3. КОГДА происходит ошибка при загрузке данных пользователя ТО система ДОЛЖНА сбросить состояние авторизации
4. КОГДА токен истекает во время работы ТО система ДОЛЖНА автоматически обновить его через интерцептор

### Требование 6

**Пользовательская история:** Как разработчик, я хочу чтобы состояние загрузки корректно отображалось в интерфейсе, чтобы пользователь понимал что происходит

#### Критерии приемки

1. КОГДА происходит авторизация ТО хук `useAuth` ДОЛЖЕН предоставлять состояние `isLoading`
2. КОГДА происходит загрузка данных пользователя ТО компоненты ДОЛЖНЫ показывать индикатор загрузки
3. КОГДА авторизация завершена ТО состояние загрузки ДОЛЖНО сброситься
4. КОГДА происходит ошибка ТО состояние загрузки ДОЛЖНО сброситься
